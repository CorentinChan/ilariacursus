<!doctype html>
<meta charset="utf-8">
<title>XSS - protégé (local)</title>
<style>body{font-family:system-ui;padding:16px}textarea{width:100%;height:80px}</style>
<h2>XSS - Protégé</h2>

<form id="f">
  <textarea name="c" placeholder="Écris un commentaire"></textarea><br>
  <button>Poster</button>
</form>

<h3>Commentaires :</h3>
<div id="list"></div>

<!-- Optionnel : DOMPurify si on veut autoriser du HTML "safe" -->
<script src="https://unpkg.com/dompurify@2.4.0/dist/purify.min.js"></script>

<script>
const form = document.getElementById('f');
// RENDRE EN TOUTE SÉCURITÉ : créer des éléments et utiliser textContent
function render(){
  const comments = JSON.parse(localStorage.getItem('comments')||'[]');
  const container = document.getElementById('list');
  container.innerHTML = ''; // vider
  comments.forEach(c => {
    // Option 1 (strict) : afficher en texte brut
    const div = document.createElement('div');
    div.textContent = c;
    container.appendChild(div);

    // Option 2 (si on veut autoriser un sous-ensemble HTML sûr) :
    // const safe = DOMPurify.sanitize(c);
    // const div = document.createElement('div');
    // div.innerHTML = safe;
    // container.appendChild(div);
  });
}

form.addEventListener('submit', e=>{
  e.preventDefault();
  const c = form.c.value;
  const comments = JSON.parse(localStorage.getItem('comments')||'[]');
  comments.push(c);
  localStorage.setItem('comments', JSON.stringify(comments));
  form.reset();
  render();
});
render();
</script>