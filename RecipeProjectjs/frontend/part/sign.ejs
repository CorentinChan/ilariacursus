<!--Signin Div-->
<% console.log("pseudo :" +user); if( !user ){ %>
<div class="overlay" id="overlay1">
  <div class="signWindow" id="signWindow">
    <button type="button" class="btn btnAc border text-center btn-danger btnClose" aria-label="Close" id="closeSignWindow" onclick="signinClose()">X</button>
    <!--<iframe src="login " width="100%" height="100%" style="border:none;"></iframe>-->
     <%- include('login', { user: user,erreur: "" }) %>
  </div>
</div>

<!-- sign up div -->
<div class="overlay3" id="overlay2">

  <div class=" container signup  ">
      <button type="button" class="btn btnAc text-center btn-danger border p-1  btnClose2" aria-label="Close" id="closeSignupWindow" onclick="signupClose()">X</button>

<div class="p-4  bg-danger rounded-5 my-5">

    <form class=" contactForm  " id="signup2Form"  action="/signup2" method="post">
      <div class="  mx-auto text-center text-grey formAlign">
        <h2 class="text-center m-4 fw-bold pt-2">Sign up</h2>
            
        <h5 class="text-center m-3 text-white">Join us and add your own recipes and many more! </h5>
        
        <label for="pseudo" class="form-label  text-center text-grey fs-4 me-3 ">Pseudo</label>
        <input type="text" class="form-control text-center   w-50 rounded-pill bg-white border border-grey text-center text-grey"
         minlength="4"  name="pseudo" id="pseudo" placeholder="pseudo" required>
        

        <label for="password" class="form-label fs-4 me-3 mt-3">Password</label>
        <input type="password" class="form-control text-center  w-50 rounded-pill bg-white border border-grey text-center text-grey"
          minlength="8" name="password" id="password" placeholder="min 8 characters" required >
            <div class="invalid-feedback">
            Minimum 8 characters
          </div>

        <label for="mail" class="form-label text-center text-grey fs-4 me-3 mt-3">Email</label>
        <input type="email" class="form-control w-75 rounded-pill bg-white border border-grey text-center text-grey " name="mail"  id="mail" placeholder="cor@ind.com" required>
            <div class="invalid-feedback">
            Please enter a valid email address.
          </div>
      </div>

      <div class=" text-center">
       <button type="button" id="signup2Submit" class="btn mx-3 fs-5 px-3 mt-3 mb-4 btn-warning  rounded-pill">Sign up</button>
    </div>
        <div class="text-center" id="responseMessagesignup2"></div>
    </form>
  </div>
</div>
</div>

      </div>
</div>

<script>

//fetch for signout check
if(document.getElementById('signup2Submit')){ 
  const buttonsignup2 = document.getElementById('signup2Submit');
  buttonsignup2.addEventListener('click', async (e) => {
  e.preventDefault(); // empÃªche le rechargement de la page
   let formsignup2 = document.getElementById('signup2Form');
   console.log('fetch function after submit');
   // const form = e.target;
    const password = formsignup2.password.value;
    const mail = formsignup2.mail.value;
    const pseudo = formsignup2.pseudo.value;

    try {
        const res = await fetch('/signup', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                password,
                mail,
                pseudo
            })
        });

        const data = await res.json();

        const message = document.getElementById('responseMessagesignup2');
        if (data.succeed) {
            message.style.color = 'green';
            message.textContent = "Your account have been created, redirect in 3s";
            buttonsignup2.remove();
             //formsignup2.remove();;
            
                     let i=2;
                  const interval = setInterval(function() {
                       message.textContent="Your account have been created, redirect in "+i+'s';
                       i-=1;
                            if (i < 0) {
                            clearInterval(interval);
                            location.reload(); // ou window.location.href = '/'; selon ton besoin
                          }
                    }, 1000); 
        } else {
            message.style.color = 'blue';
            message.textContent = data.message;
        }

    } catch (err) {
        console.error(err);
        document.getElementById('responseMessagesignup2').textContent = 'Erreur de connexion au serveur.';
    }
    });

  }

  
</script>
</script>
<% } %>
