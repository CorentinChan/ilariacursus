<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js" defer></script>


  <link rel="stylesheet" href="style.css"> 
  <link rel="stylesheet" href="styleResp.css"> 
    <link rel="stylesheet" href="animation.css"> 

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

   <title><%=title%></title>
</head>
<body>

    <!--navigation bar -->
        <%- include('part/nav', { user: user }) %>

<!--Recipe Description-->
<section class="recipeTitle row gx-0">

  <div class="d-lg-flex container ">
        <!--img-->
        <div class="col-lg-6">
        <div class=" justify-content-center  image-container">
        <img src="<%=recipe.image %>" class=" tilt1  pt-3 rounded-5 recipePhoto" alt="image">
        </div>
          </div>
        <!--description-->
         <div class="col-lg-6" >
    <div class=" pt-3 descriptionRecipe">
            <!--title-->
    <h1 class="fade-in mb-0"><%=recipe.title %></h1>
    <p class="mt-1 ps-3 pt-1">  <%=recipe.note%><i class="fa-solid fa-star"> </i>
      <!--
     <% if (recipe.note) { for(let i=0;i<5;i++){ console.log(recipe.note);  if(recipe.note>i) {  %>
                <i class="fa-solid fa-star">  </i> <% }else{ %>
              <i class="fa-regular fa-star"></i>
              <% }} %>
                  ( <%=notes.length%>  )
              <% }  %>   -->
        
    </p>
    <%    const regex = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/;
          if(regex.test(recipe.description)){ %>
    <a class="ps-3" href="<%=recipe.description%>" target="_blank"><i class="fa-brands fa-youtube fs-1"></i></a>
            <% }else{ %>
    <p class="text-black-50  fs-4"><%=recipe.description %></p>
          <%}%>
    <!--Recipe info-->
    <div class="d-flex text-center  descriptionLogos border-bottom">
        <div class="logo1  p-3 mx-2  m-lg-3 px-lg-5 text-center border-end">
       <i class="fa-regular fa-clock fs-3 rotatec"></i>
       <p class="m-0 p-0" >Active time</p>
        <p class="m-0 p-0 text-black-50 " id="activeTime"><%=recipe.activeTime%></p>
        </div>
        <div class="logo2  p-3 mx-2 m-lg-3 px-lg-5 text-center border-end">  
        <i class="fa-solid fa-clock-rotate-left fs-3 rotatec"></i>
        <p class="m-0 p-0" >Total Time</p>
        <p class="m-0 p-0 text-black-50 " id="totalTime"><%=recipe.totalTime%></p>
        </div>
        <div class="logo3 p-3 mx-2 m-lg-3 px-lg-5 text-center">        
        <i class="fa-solid fa-users fs-3"></i>
        <p class="m-0 p-0" >Yield</p>
        <p class="m-0 p-0 text-black-50" id="yield"> <%=recipe.yield%></p>
        </div>
    </div>


    <div class="d-flex mt-5 bottomDescription">
    
    <div class="container">
    <p class="m-0 p-0">Created by <span class="text-danger" id="author"><%=recipe.auteur%></span> </p>
    <p class="m-0 p-0 text-black-50" id="nbRecipes"> <% %> </p>
    </div>
    
       <div class="d-flex justify-content-center ">
        <% if (user){  %>
        <form method="post" action="/addList">
        <button type="submit" class="border-0 bg-white"><i class="fa-regular fa-plus fs-3 mx-3 clickable"></i></button> 
        </form>
        <%}%>
        <i class="fa-solid fa-cart-arrow-down fs-3 mx-3 clickable"></i>
        <i class="fa-solid fa-print fs-3 mx-3 clickable" id="print"></i>
    </div>
    </div>
    
         </div>


    </div>
  </div>
</section>

  <section class="m-1 p-1 m-lg-5 p-lg-3 makeRecipe-container">

        <!--left section with instructions and  comments-->
<div class="recipeLeft">
    <div class="recipeSteps">
        <h2 class=" mt-5  my-lg-0">How to make it</h2>
    <ol class="mt-lg-4 list-group instructionsList"  >

        <% let i=0;
        instructions.forEach(step => { %>
  

        <li class=" d-flex border-0 " > <i class="fa-regular fa-circle-check fs-2 me-3 "></i> <h4 class="text-danger pt-1"><%=i%>.STEP</h4><div class="container-fluid border-top m-3 me-5"></div> </li>
        <li class="list-group-item border-0 border-bottom-1 mx-5  text-black-50 fs-5" > <%=step.instruction%></li>
         <% i++; }); %>
        
    </ol>
    </div>

        <!--comms tab-->
     <div class="comments mt-lg-5 pt-5  " id="comments">
      <h3>Comments</h3>

<% let alt=false; commentaires.forEach((commentaire, index)=> {
  let userNote = notes.find(n => n.userID === commentaire.userID && n.recipeID === commentaire.recipeID); %>
  <% if (alt===false) { %>
    <div class="list-group p-lg-3">
      <div class="list-group-item" aria-current="true">
        <div class=" w-100 justify-content-between">
          <%}else{%>
            <div class="list-group p-lg-3 com-container2">
              <div class="list-group-item  bg-danger-subtle" aria-current="true">
                <div class="d-flex flex-column w-100 justify-content-between">
                  <%} alt=!alt;%>
                <div class="d-flex ">

                      <img class="imageComm mx-lg-0 me-2 me-lg-3 py-1   rounded-circle" src="<%=commentaire.image%>">
                  <div class="d-flex flex-column mt-2 mt-lg-3">
                      <h5 class="mb-1"><%=commentaire.pseudo%> </h5>
                      <small class="text-black-50">
                        <% const day=commentaire.date.getDate().toString().padStart(2, '0' ); const
                          month=(commentaire.date.getMonth() + 1).toString().padStart(2, '0' ); // Mois 0-11 const
                          year=commentaire.date.getFullYear(); const date=day+'/'+month+'/'+year %>
                          <%=date%>
                      </small>
                      <div class="">
                          <% if (userNote) { for(let i=0;i<5;i++){ console.log(userNote.note); if(userNote.note>i) { %>
                            <i class="fa-solid fa-star"> </i>
                            <% }else{ %>
                              <i class="fa-regular fa-star"></i>
                              <% }}} %></div>
                      </div> </div>
                    <p class="my-1 py-3">
                      <%=commentaire.commentaire%>
                    </p>
                                        
                  
                </div> 
              </div>
            </div>

            <%});%>
  
 <%if(user){ %> 
 <div class=" d-flex w-100 justify-content-between mt-5">
  <form method="post" action="giveNote">
              <div class="d-flex"><i class="fa-solid fa-star p-3"></i> 
    <select class="form-select form2" onchange="this.form.submit()" name="note">
  <option selected disabled>Give a note</option>
       <option value="1">1</option>
     <option value="2">2</option>
     <option value="3">3</option>
     <option value="4">4</option>
      <option value="5">5</option>
   </select>
  </form>
            </div>
            </div>

            
      <div class="list-group p-lg-3">
          <div class="list-group-item" aria-current="true">
            
            <p class="my-1 py-3">  <form method="post" action="addComment">
    <div class=" ">
      <label for="comment">Comments:</label>
      <textarea class="form-control" rows="5" name="comment" id="commentForm" name="text"></textarea>
    </div>
    <button type="submit" class="btn mt-3 btn-primary ">Submit</button>
  </form></p>
          </div>
      </div>
  <% } %>
      

    </div>

</div>


<!-- right section with ingredients&co-->
<div class="recipeRight">

    <!--ingredients tab-->
    <div class="mt-5 mt-lg-0 recipeIngredients">
    <h2>Ingredients</h2>
    <ul class="list-group ingredientsList" >
      <%ingredients.forEach(ing => { %>
        <li class="list-group-item border-0 border-bottom" > <%=ing.measure%>      <%=ing.ingredient%></li>
        <% }); %>
    </ul>
    </div>

    <!--tags tab-->
    <div class=" pt-3 mt-3">
      <h3 >Tags</h3>
      <div class="tags">
           <%tags.forEach(tag => { %>
      <span class="badge text-bg-primary m-2 fs-5"><%=tag.tag%></span>
            <%});%>
      </div>  

    </div>

        <!--share recipe tab-->
    <div class="shareRecipe pt-3 mt-3">
      <h3 >Share recipes</h3>
  <div class="d-flex justify-content-center me-5 pe-lg-5">
<i class="fa-brands fa-facebook fa-2x p-3" ></i>
<i class="fa-brands fa-instagram fa-2x p-3"></i>
<i class="fa-brands fa-twitter fa-2x p-3"></i>

  </div>
    </div>


</div>  

  </section>

<!--4 videos recommanded -->

 <section class="videoSection2 container-fluid py-5   ">

  <div class="videoTitle m-3 m-lg-5 ">
<h2>Others videos you may like</h2>

  </div>

<div class="d-flex videos-container m-lg-5 flex-wrap "  >
<% recipesForU.forEach(recipe => { %>
  <div class="card shadow-sm h-100 mx-2">
    <form method="post" action="/goRecipe" id="myForm">
      <button type="submit" class="p-0 border-0 bg-transparent ">
        <input hidden name="recipeID" value="<%=recipe.id%>">
        <img src="<%= recipe.image %>" class="card-img-top" alt="<%= recipe.title %>">
        <div class="card-body pb-0">
          <h5 class="card-title text-black-50">
            <%= recipe.title %>
          </h5>
          <div class="d-flex justify-content-between pt-3 pb-0 mb-0">
            <span><%=recipe.note%><i class=" pb-1 ms-1 fa-solid fa-star"></i></span>
            <span class="card-text">
              <%= recipe.auteur %>
            </span>
          </div>

  </div>
        </button>
    </form>
  </div>
  <% }); %>

</div>


</section>


<footer>
<!--footer with logos and links -->

<!--logos with fontawesome-->
  <div class="logos me-5 pe-lg-5">
<i class="fa-brands fa-facebook fa-2x p-3" ></i>
<i class="fa-brands fa-instagram fa-2x p-3"></i>
<i class="fa-brands fa-twitter fa-2x p-3"></i>

  </div>

  <div class="container mt-3">           
  <div class="table-perso">

      <ul>
        <li><a href="">Presentations</a></li>
        <li><a href="">Profesionals</a></li>
        <li><a href="">Stores</a></li>
      </ul>
              <ul>
         <li><a href="">Webinars      </a></li>
          <li ><a href="">Workshops</a></li>
         <li><a href="">Local Meetups</a></li>
      </ul>
        <ul>
         <li><a href="">Ours initiative</a></li>
          <li><a href="">Giving Back</a></li>
         <li><a href="">Communities</a></li>
      </ul>
        <ul>
        <li><a href="">Contact Form</a></li>
        <li><a href="">Work with us</a></li>
        <li><a href="">Visit us</a></li>
      </ul>
             

</div>

  <p class="textTab">Made by C.C</p> 


</footer>



<!--Signin Div-->
<% user='';console.log(user); if( !user || user===""){ %>
<div class="overlay" id="overlay1">
  <div class="signWindow" id="signWindow">
    <button type="button" class="btn btnAc border text-center btn-danger btnClose" aria-label="Close" id="closeSignWindow" onclick="signinClose()">X</button>
    <iframe src="login " width="100%" height="100%" style="border:none;"></iframe>
  </div>
</div>
<% } %>
<!-- sign up div -->

<div class="overlay3" id="overlay2">

  <div class=" container signup  ">
      <button type="button" class="btn btnAc text-center btn-danger border p-1  btnClose2" aria-label="Close" id="closeSignupWindow" onclick="signupClose()">X</button>

  <div class="p-4  bg-danger border  rounded-5">

       <form class=" contactForm  "  action="/signup" method="post">
      <div class="  mx-auto text-center text-grey formAlign">
        <h2 class="text-center m-4 fw-bold pt-2">Sign up</h2>
            
        <h5 class="text-center m-3 text-white">Join us and add your own recipes and many more! </h5>
        
        <label for="pseudo" class="form-label  text-center text-grey fs-4 me-3 ">Pseudo</label>
        <input type="text" class="form-control text-center   w-50 rounded-pill bg-white border border-grey text-center text-black"  name="pseudo" id="pseudo" placeholder="pseudo" required>
        

        <label for="password" class="form-label fs-4 me-3 mt-3">Password</label>
        <input type="text" class="form-control text-center  w-50 rounded-pill bg-white border border-grey text-center text-black" name="password" id="password" placeholder="pseudo" required >
      
        <label for="mail" class="form-label text-center text-grey fs-4 me-3 mt-3">Email</label>
        <input type="text" class="form-control w-75 rounded-pill bg-white border border-grey text-center text-black " name="mail"  id="mail" placeholder="cor@ind.com" requires>

      </div>


      <div class=" text-center">
       <button type="submit" class="btn mx-3 fs-5 px-3 mt-3 mb-4 btn-warning  rounded-pill">Sign up</button>
    </div>

    </form>

  </div>
</div>

</div>
</div>


</body>
</html>